class CurrencyInput{constructor(e,t={}){this.target="string"==typeof e?document.querySelector(e):e,this.reinit(t),this.lastKeyDead=!1,this.target.addEventListener("cut",this.validateInput.bind(this)),this.target.addEventListener("paste",this.validateInput.bind(this)),this.target.addEventListener("keydown",this.validateInput.bind(this)),this.target.addEventListener("compositionend",this.validateInput.bind(this)),this.target.addEventListener("drop",function(){event.preventDefault()}),this.target.addEventListener("input",this.format.bind(this))}format(event){const e=this.getCurrencySymbolAndPosition(),t=this.getDecimalCharacter(),a=this.getSeparationCharacter();let r=this.defaultValue;const i=1==this.target.value.length&&e.displayBefore?e.symbol.length:0;if("undefined"!=typeof event){r=this.getEventValue(event).replaceAll(e.symbol,"");var l=""!=a?r.length:0;""!=a&&(r=r.replaceAll(new RegExp("\\"+a,"g"),"")),r=r.replaceAll(new RegExp("\\"+t,"g"),".").replaceAll(/\s/g,"");const i=new RegExp(`^[^\\.]*\\.(\\d{0,${this.getCurrencyDecimalCount()}})?$`);var n=null!=r.match(i);if(n&&(r+="1"),"-"==r&&e.displayBefore)return void(this.target.value="-"+e.symbol);if(""==r||r==e.symbol.replaceAll(/\s/g,""))return void(this.target.value="");r=parseFloat(r)}if(isNaN(r))return;r=r.toLocaleString(this.locale),n&&(r=r.slice(0,-1)),r=(r=(r=r.replaceAll(new RegExp("\\"+this.getDecimalCharacter(!0),"g"),"/")).replaceAll(new RegExp("\\"+this.getSeparationCharacter(!0),"g"),a)).replaceAll("/",t);const s=this.target.selectionStart,c=this.target.selectionEnd,o=""!=a?r.length:0;e.displayBefore?this.target.value=r<0?"-"+e.symbol+r.substring(1):e.symbol+r:this.target.value=r+e.symbol;const h=isNaN(o-l)?0:o-l;this.target.selectionStart=s+h+i,this.target.selectionEnd=c+h+i}reinit(e){if(this.currencyCodes=["AED","AFN","ALL","AMD","ANG","AOA","ARS","AUD","AWG","AZN","BAM","BBD","BDT","BGN","BHD","BIF","BMD","BND","BOB","BRL","BSD","BTN","BWP","BZD","CAD","CDF","CHF","CLP","CNY","COP","CRC","CUC","CUP","CVE","CZK","DJF","DKK","DOP","DZD","EGP","ERN","ETB","EUR","FJD","FKP","GBP","GEL","GHS","GIP","GMD","GNF","GTQ","GYD","HKD","HNL","HRK","HTG","HUF","IDR","ILS","INR","IQD","IRR","ISK","JMD","JOD","JPY","KES","KGS","KHR","KMF","KPW","KRW","KWD","KYD","KZT","LAK","LBP","LKR","LRD","LSL","LYD","MAD","MDL","MGA","MKD","MMK","MNT","MOP","MUR","MVR","MWK","MXV","MYR","MZN","NAD","NGN","NIO","NOK","NPR","NZD","OMR","PAB","PEN","PGK","PHP","PKR","PLN","PYG","QAR","RON","RSD","RUB","RWF","SAR","SBD","SCR","SDG","SEK","SGD","SHP","SLL","SOS","SRD","SSP","SYP","SZL","THB","TJS","TMT","TND","TOP","TRY","TTD","TWD","TZS","UAH","UGX","USD","UYU","UZS","VND","VUV","WST","XAF","XCD","XDR","XOF","XPF","YER","ZAR","ZMW"],void 0!==e.currency&&!this.currencyCodes.includes(e.currency))throw new TypeError(e.currency+"is an unknown currency code. Refer to ISO 4217 for a list of valid codes or leave empty to default to USD.");if(this.currency="string"==typeof e.currency?e.currency:"USD",this.locale="string"==typeof e.locale?e.locale:"en-US",this.currencyDisplay="string"==typeof e.currencyDisplay?e.currencyDisplay:"symbol",this.currencyDisplayFallback="string"==typeof e.currencyDisplayFallback?e.currencyDisplayFallback:"code",this.decimalCharacter=e.decimalCharacter,this.separationCharacter=e.separationCharacter,this.getDecimalCharacter()==this.getSeparationCharacter())throw new TypeError("Decimal and separation characters must not be the same.");if("/"==this.getDecimalCharacter()||"/"==this.getSeparationCharacter())throw new TypeError("The devider characters must not be a forward slash.");this.disableCents="boolean"==typeof e.disableCents&&1==e.disableCents,this.preventInputFromIME=void 0===e.preventInputFromIME||"boolean"!=typeof e.preventInputFromIME||0!=e.preventInputFromIME,this.min="number"==typeof e.min&&e.min,this.max="number"==typeof e.max&&(e.max>=this.min||!1===this.min)&&e.max,this.validCallback="function"==typeof e.validCallback&&e.validCallback,this.invalidCallback="function"==typeof e.invalidCallback&&e.invalidCallback,"number"==typeof e.defaultValue?(this.validateInput({type:"keydown",key:e.defaultValue,target:this.target,synthetic:!0}),this.defaultValue=e.defaultValue):this.target.value="",this.format()}getCurrencySymbolAndPosition(){if("none"===this.currencyDisplay)return{displayBefore:!1,symbol:""};if("symbol"==this.currencyDisplay)var e=(0).toLocaleString(this.locale,{style:"currency",currency:this.currency,currencyDisplay:"symbol",minimumFractionDigits:0,maximumFractionDigits:0});else if("code"==this.currencyDisplay)e=(0).toLocaleString(this.locale,{style:"currency",currency:this.currency,currencyDisplay:"code",minimumFractionDigits:0,maximumFractionDigits:0});return"name"==this.currencyDisplay||e.replaceAll(/\d/g,"").trim()==this.currency&&"name"==this.currencyDisplayFallback?{displayBefore:!1,symbol:" "+new Intl.DisplayNames(this.locale,{type:"currency"}).of(this.currency)}:"symbol"==this.currencyDisplay&&e.replaceAll(/\d/g,"").trim()==this.currency&&"none"==this.currencyDisplayFallback?{displayBefore:!1,symbol:""}:{displayBefore:0!=e.indexOf(0),symbol:e.replaceAll(/\d/g,"")}}getDecimalCharacter(e=!1){return 0==this.getCurrencyDecimalCount()?"\\":"string"!=typeof this.decimalCharacter||e?(0).toLocaleString(this.locale,{style:"currency",currency:this.currency,currencyDisplay:"code",minimumFractionDigits:1,maximumFractionDigits:1}).replace(this.currency,"").replaceAll(/(\d)*/g,"").trim()[0]:this.decimalCharacter[0]}getSeparationCharacter(e=!1){return"string"!=typeof this.separationCharacter||e?1e3.toLocaleString(this.locale,{style:"currency",currency:this.currency,currencyDisplay:"code",minimumFractionDigits:0,maximumFractionDigits:0}).replace(this.currency,"").replaceAll(/(\d)*/g,"").trim()[0]:""==this.separationCharacter?"":this.separationCharacter[0]}getCurrencyDecimalCount(){return(new Intl.NumberFormat("en",{style:"currency",currency:this.currency,signDisplay:"never",currencyDisplay:"code"}).format(1).substr(4).match(/(0)/g)||[]).length}getEventValue(e){if("keydown"==e.type&&(["Control","Shift","CapsLock","Alt","Command","AltGraph","Meta","ContextMenu","ArrowUp","ArrowDown","ArrowLeft","ArrowRight","PageUp","PageDown","End","Home","Insert"].includes(e.key)||e.ctrlKey)&&(!e.ctrlKey||"Backspace"!=e.key)&&("Backspace"!=e.key||!e.metaKey)&&(!e.ctrlKey||"Delete"!=e.key)&&(!e.metaKey||"Delete"!=e.key))return e.target.value;if("paste"==e.type||"cut"==e.type)return e.target.value.slice(0,e.target.selectionStart)+e.clipboardData.getData("text/plain")+e.target.value.slice(e.target.selectionEnd);if("keydown"==e.type&&"Backspace"!=e.key&&"Delete"!=e.key)return e.target.value.slice(0,e.target.selectionStart)+e.key+e.target.value.slice(e.target.selectionEnd);if("keydown"==e.type&&("Backspace"==e.key||"Delete"==e.key)){return(-1!=navigator.userAgent.indexOf("Mac OS X")?e.metaKey:e.ctrlKey)&&e.target.selectionStart==e.target.selectionEnd?"Delete"==e.key?e.target.value.slice(0,e.target.selectionStart):e.target.value.slice(e.target.selectionStart,e.target.value.length):e.target.selectionStart!=e.target.selectionEnd?e.target.value.slice(0,e.target.selectionStart)+e.target.value.slice(e.target.selectionEnd):"Delete"==e.key?e.target.value.slice(0,e.target.selectionStart)+e.target.value.slice(e.target.selectionEnd+1):e.target.value.slice(0,e.target.selectionStart-1)+e.target.value.slice(e.target.selectionEnd)}return e.target.value}getValueAsString(){return this.target.value}getValueAsFloat(){let e=this.target.value.replaceAll(this.getCurrencySymbolAndPosition().symbol,"").replaceAll(new RegExp("\\"+this.getSeparationCharacter(),"g"),"").replaceAll(new RegExp("\\"+this.getDecimalCharacter(),"g"),".").replaceAll(/\s/g,"");return parseFloat(e)}getValueAsInt(){const e=this.getValueAsFloat(),t=this.getCurrencyDecimalCount();return e*Math.pow(10,t)}validateInput(e){const t=this.getCurrencySymbolAndPosition(),a=this.getSeparationCharacter();let r=this.getEventValue(e).replaceAll(t.symbol,"").replaceAll(/\s/g,"");""!=a&&(r=r.replaceAll(new RegExp("\\"+a,"g"),""));const i=this.getDecimalCharacter(),l=this.getCurrencyDecimalCount();let n="^";if((this.min<0||!1===this.min)&&(n+="(\\-)?"),0==l||this.disableCents?n+="([1-9]*|[1-9]{1}\\d*)":n+="([1-9]*|0|[1-9]{1}[0-9]*){1}((?<=\\d)[\\"+i+"]\\d{0,"+l+"})?",n+="$","-"==r)var s=0;else if(r.slice(-1)==i)s=parseFloat(r.replace(new RegExp("\\"+i),".")+Math.pow(10,-l).toString().replace("0.",""));else s=parseFloat(r.replace(new RegExp("\\"+i),"."));null===r.match(new RegExp(n))||!1!==this.min&&s<this.min||!1!==this.max&&s>this.max||s>999999999999999/Math.pow(10,this.disableCents?0:l)||s<-999999999999999/Math.pow(10,this.disableCents?0:l)||this.getEventValue(e).includes("-"+this.getSeparationCharacter())?(this.preventInputFromIME&&"compositionend"==e.type&&(this.target.value=this.target.value.replace(e.data,"")),"function"==typeof this.invalidCallback&&this.target.value!=r&&this.invalidCallback(),void 0===e.synthetic&&e.preventDefault()):("function"==typeof this.validCallback&&r!=this.target.value&&this.validCallback(),void 0!==e.synthetic&&(this.target.value=e.key)),this.lastKeyDead&&this.target.blur(),this.lastKeyDead="keydown"==e.type&&"Dead"==e.key}}
